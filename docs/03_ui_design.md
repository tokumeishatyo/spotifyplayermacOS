<!-- rule.mdを読むこと -->
# UI設計書 (UI Design)

## 1. デザイン指針
- **ネイティブ感**: macOSの標準的なUIガイドラインに準拠し、サイドバーやツールバーを活用する。
- **効率的な操作**: プレイリスト編集が主目的であるため、ドラッグ&ドロップやコンテキストメニューを積極的に活用する。
- **rule.mdの遵守**: 選択肢の数に応じたUI（Segmented Picker / Dropdown）の使い分けを徹底する。

## 2. 画面構成
アプリは主要な3つのセクションで構成する。

### 2.1 メインウィンドウ (NavigationSplitView)
- **Sidebar (左側)**:
    - ユーザープロフィール
    - ライブラリ（プレイリスト一覧）
    - 設定へのショートカット
- **Detail (中央/右側)**:
    - 選択されたプレイリストの楽曲一覧（エディタ）
    - 楽曲の検索・追加インターフェース

### 2.2 プレイヤーバー (下部)
- 再生コントロール（再生/一時停止、スキップ、リピート、シャッフル）
- 現在再生中の曲情報（ジャケット、曲名、アーティスト名）
- プログレスバー（シークバー）
- 音量調整

## 3. 各画面の詳細

### 3.1 プレイリスト詳細（楽曲管理画面）
- **左列（サイドバー）の挙動**:
    - **表示形式**: ユーザーのプレイリストをフラットリスト形式で表示（画像＋名前）。
    - **リフレッシュ**: サイドバーのツールバーにある更新ボタンより、最新のプレイリスト一覧を再取得可能。
    - プレイリスト名クリック: 中央カラムに楽曲リストを表示。
- **中央カラム（楽曲リスト）**:
    - **UIコンポーネント**: `List` を使用。
    - **ヘッダー**: 
        - プレイリスト画像、タイトル、説明文、総楽曲数を表示。
        - **プレイリスト削除**: ゴミ箱ボタンより、プレイリスト自体の削除（ライブラリからの削除）が可能。
    - **通常モード**:
        - 楽曲クリック: 再生（ログ出力）。
        - 「編集」ボタン: 押下すると「編集モード」へ移行。
        - 「削除」ボタン: 非活性（Disabled）。
    - **編集モード**:
        - **表示**: 各行の左側にチェックボックスとドラッグハンドル（≡）を表示。
        - **操作ボタン**: 
            - 「全選択」「選択解除」ボタン。
            - 「追加」ボタン: 選択した楽曲を**他のプレイリスト（新規または既存）へコピー**可能。
            - 「削除」ボタン: 1曲以上選択されると活性化。押下で確認ダイアログ表示後、API経由で削除実行。
        - **選択**: 行クリックでチェックボックスのON/OFFが切り替わる。
        - **並べ替え**: ドラッグハンドル（または行全体）をドラッグ＆ドロップして順序変更（API同期）。
        - **削除**: 1曲以上選択されると「削除」ボタンが活性化。押下で確認ダイアログ表示後、API経由で削除実行。

### 3.2 楽曲検索画面
- **検索条件**:
    - 以下のカテゴリで検索可能にする。
        1. アーティスト
        2. アルバム
        3. 楽曲
- **表示形式**:
    - **Track / Artist**: リスト形式で楽曲を表示。
    - **Album**: グリッド形式でアルバムアートワークを表示。クリックでアルバム詳細画面へ遷移。
- **アルバム詳細画面**:
    - アルバム内の楽曲一覧を表示。
    - 編集モードにより、楽曲を選択（全選択可）してプレイリストに追加可能（削除機能はなし）。
- **プレイリスト追加フロー**:
    - 「プレイリストに追加」押下でダイアログ表示。
        - 1曲以上選択で「プレイリストに追加」ボタンが活性化。
- **プレイリスト追加フロー**:
    - 「プレイリストに追加」押下でダイアログ表示。
    - 選択肢:
        1. **新規プレイリストに追加**: 名前入力フィールド表示 → 作成＆追加。
        2. **既存のプレイリストに追加**: プレイリスト一覧（チェックボックス付き）表示 → 選択した全てに追加。
        3. **キャンセル**

### 3.3 設定画面 (Settings)
- **音質設定**: 
    - 選択肢が4個以下の場合: Segmented Picker (横並びボタン)
    - 選択肢が5個以上の場合: Dropdown (Picker)
- **ログアウト**: アカウント連携解除ボタン。

### 3.4 ミニプレイヤー (Mini Player)
- **概要**: 独立した小さなウィンドウで再生コントロールと楽曲情報を表示。
- **起動**: メインウィンドウ右下のアイコンから起動（メインウィンドウは閉じる）。
- **UI構成**:
    - 背景: 現在の楽曲のアートワーク（ぼかし処理）。
    - 中央: アートワーク、曲名、アーティスト名、再生コントロール（再生/一時停止、スキップ）。
- **メイン復帰**: アートワーク画像をクリックすると、ミニプレイヤーが閉じ、メインウィンドウが復帰する。

## 4. インタラクションルール (rule.mdに基づく)
- **リピート設定**:
    - [Off, Context, Track] の3つのため、**Segmented Picker** を使用。
- **再生デバイス選択**:
    - 利用可能なデバイスが4台以下の場合は **Segmented Picker**、5台以上の場合は **Dropdown** に動的に切り替える。
- **音質選択**:
    - [Low, Normal, High, Very High] の4つのため、**Segmented Picker** を使用。
- **検索表示件数**:
    - [10, 20, 50] の3つのため、**Segmented Picker** を使用。

## 5. 視覚的フィードバック
- 楽曲移動時のプレビュー表示。
- API通信中のプログレスインジケータ。
- Premiumユーザー確認失敗時の警告ダイアログ。
