<!-- rule.mdを読むこと -->
# 設定時に必要なこと

このドキュメントは、プロジェクトのビルドおよび実行に必要なXcode上の手動設定、およびSpotify API特有の注意点を記録します。

## 1. 外部設定ファイル (Config.xcconfig)
機密情報をGit管理から除外するため、`xcconfig`ファイルを使用しています。

- **ファイルパス**: `spotifyplayer/Config.xcconfig`
- **内容**:
  ```properties
  SPOTIFY_CLIENT_ID = [あなたのClient ID]
  // スラッシュがコメントとして解釈されるのを防ぐため、/$()/ ハックを使用
  SPOTIFY_REDIRECT_URI = spotifyplayer:/$()/callback
  ```
- **注意**: 新規環境でビルドする際は必ずこのファイルを新規作成し、正しいIDを記述すること。

## 2. Xcode プロジェクト設定 (Project & Target)

### 2.1 Configurations (Project設定)
- **場所**: Project > Info > Configurations
- **設定**: Debug および Release の各ターゲット（spotifyplayer）に `Config.xcconfig` を適用する。

### 2.2 Info.plist (Target Properties)
- **場所**: Target > Info > Custom macOS Application Target Properties
- **追加キー**:
  - `SpotifyClientID`: `$(SPOTIFY_CLIENT_ID)`
  - `SpotifyRedirectURI`: `$(SPOTIFY_REDIRECT_URI)`

### 2.3 URL Types (スキーム設定)
- **場所**: Target > Info > URL Types
- **設定**:
  - `Identifier`: `com.spotifymanager.spotifyplayer` (または自身のBundle ID)
  - `URL Schemes`: `spotifyplayer`
- **目的**: 認証完了後にブラウザからアプリへ制御を戻すために必要。

### 2.4 App Sandbox (権限設定)
- **場所**: Target > Signing & Capabilities > App Sandbox
- **必須設定**:
  - `Network: Outgoing Connections (Client)`: **ON**
  - **理由**: Spotify APIへの通信および、認証セッションの維持（Keychainへの保存・取得）に必要。

### 2.5 Keychain Sharing (任意)
- **設定**: 基本的にデフォルトのままで問題ありませんが、特定の環境でKeychainアクセスに失敗する場合は、`Keychain Sharing` を有効にし、アプリのBundle IDを追加してください。
- **実装上の注意**: `KeychainHelper.swift` 内の `service` 定数はアプリの識別子（例: `com.spotifymanager.spotifyplayer`）と一致させています。

## 3. Spotify Developer Dashboard 側の設定
- **Redirect URIs**: `spotifyplayer://callback` を登録済みであること。
- **注意**: アプリ側の設定と一文字でも異なると `Illegal redirect_uri` エラーが発生する。

## 4. トラブルシューティング
- **認証後にアプリに戻らない**: ブラウザを再起動するか、Xcodeで `Clean Build Folder` (Cmd+Shift+K) を実行すること。
- **署名エラー**: Xcodeの Settings > Accounts でApple IDに再ログインし、Signing & Capabilities で正しいTeamを選択すること。
